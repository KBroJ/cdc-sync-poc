# 환경 시작 가이드

> **목표**: 5분 안에 CDC PoC 환경을 시작하고 접속합니다.

---

## 1. 사전 준비

### 1.1 필수 설치

| 프로그램 | 확인 방법 | 설치 링크 |
|---------|----------|----------|
| Docker Desktop | `docker --version` | [docker.com](https://www.docker.com/products/docker-desktop/) |
| Git Bash (Windows) | `bash --version` | [git-scm.com](https://git-scm.com/downloads) |

### 1.2 Docker 메모리 설정

Oracle 컨테이너 2개를 실행하려면 최소 **8GB RAM** 필요:

```
Docker Desktop → Settings → Resources → Memory → 8GB 이상
```

---

## 2. 환경 시작

### 2.1 통합 시작 (권장)

```bash
# 프로젝트 폴더로 이동
cd poc

# 전체 환경 자동 시작 (약 5분 소요)
./scripts/start-all.sh
```

**실행 과정**:
```
1단계: Docker Compose 시작     ✓
2단계: Oracle healthy 대기     ✓ (약 2-3분)
3단계: Debezium Oracle 설정    ✓
4단계: Debezium 커넥터 등록    ✓
```

### 2.2 수동 시작 (문제 발생 시)

```bash
# 1. 컨테이너만 시작
cd poc
docker-compose up -d

# 2. Oracle 준비 대기 (healthy 될 때까지)
docker-compose ps

# 3. Debezium 설정
./scripts/setup-debezium-oracle.sh

# 4. 커넥터 등록
./scripts/register-connectors.sh
```

---

## 3. 환경 상태 확인

### 3.1 컨테이너 상태

```bash
docker-compose ps
```

**정상 상태**:
```
NAME            STATUS
asis-oracle     Up (healthy)    ← 중요!
tobe-oracle     Up (healthy)    ← 중요!
kafka           Up
kafka-connect   Up
sync-service    Up (healthy)
kafka-ui        Up
zookeeper       Up
```

### 3.2 Debezium 커넥터 상태

```bash
curl http://localhost:8083/connectors
```

**정상 응답**:
```json
["asis-connector","tobe-connector"]
```

```bash
# 상세 상태 확인
curl http://localhost:8083/connectors/asis-connector/status
```

**정상 응답**:
```json
{
  "connector": {"state": "RUNNING"},
  "tasks": [{"state": "RUNNING"}]
}
```

---

## 4. 접속 URL

| 서비스 | URL | 용도 |
|--------|-----|------|
| **CDC 시뮬레이터** | http://localhost:8082/simulator | 테스트 UI |
| Kafka UI | http://localhost:8081 | Kafka 모니터링 |
| Kafka Connect API | http://localhost:8083 | 커넥터 관리 |

### 4.1 데이터베이스 접속 정보

| DB | 호스트:포트 | 사용자 | 비밀번호 |
|----|------------|--------|---------|
| ASIS Oracle | localhost:15210 | asis_user | asis123 |
| TOBE Oracle | localhost:15220 | tobe_user | tobe123 |

**DBeaver/SQL Developer 접속 예시**:
```
- Host: localhost
- Port: 15210 (ASIS) 또는 15220 (TOBE)
- Database: XEPDB1
- User: asis_user / tobe_user
```

---

## 5. 환경 중지/재시작

### 5.1 환경 중지

```bash
cd poc
docker-compose stop
```

### 5.2 환경 재시작

```bash
cd poc
docker-compose start
```

> **참고**: 재시작 시에는 Debezium 재설정 불필요 (설정이 볼륨에 유지됨)

### 5.3 완전 초기화 (주의!)

```bash
cd poc

# 컨테이너 + 볼륨 모두 삭제 (데이터 삭제됨!)
docker-compose down -v

# 다시 시작하려면 start-all.sh 실행
./scripts/start-all.sh
```

---

## 6. 문제 해결

### 6.1 Oracle이 healthy가 안 됨

```bash
# 로그 확인
docker logs asis-oracle

# 메모리 부족인 경우
# → Docker Desktop 메모리를 8GB 이상으로 설정
```

### 6.2 커넥터가 FAILED 상태

```bash
# 에러 확인
curl http://localhost:8083/connectors/asis-connector/status

# Debezium 재설정
./scripts/setup-debezium-oracle.sh
./scripts/register-connectors.sh
```

### 6.3 더 자세한 문제 해결

→ [04-운영/04_트러블슈팅.md](../04-운영/04_트러블슈팅.md)

---

## 7. 다음 단계

환경이 정상적으로 시작되었다면:

→ [03_첫_동기화_테스트.md](03_첫_동기화_테스트.md)로 이동

---

*작성일: 2026-01-14*
