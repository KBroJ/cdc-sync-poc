# 첫 동기화 테스트

> **목표**: CDC가 실제로 동작하는지 직접 확인합니다.

---

## 1. 시뮬레이터 접속

브라우저에서 열기:
```
http://localhost:8082/simulator
```

**화면 구성**:
- **테스트 실행 탭**: INSERT/UPDATE/DELETE 테스트
- **동기화 흐름 탭**: 데이터가 어디까지 진행됐는지 확인
- **이력/통계 탭**: 성공/실패 기록

---

## 2. 테스트 1: ASIS → TOBE 동기화

### 2.1 ASIS에 데이터 추가

**시뮬레이터에서**:
1. 테이블 선택: `BOOK (도서)`
2. 탭: `테스트 실행`
3. `INSERT` 버튼 클릭

**또는 터미널에서**:
```bash
docker exec asis-oracle bash -c 'sqlplus -s asis_user/asis123@//localhost:1521/XEPDB1 << EOF
INSERT INTO BOOK_INFO (BOOK_ID, BOOK_TITLE, AUTHOR, CATEGORY, STATUS)
VALUES (999, '\''테스트도서'\'', '\''테스트저자'\'', '\''01'\'', '\''Y'\'');
COMMIT;
EOF'
```

### 2.2 TOBE에서 확인

10초 정도 대기 후:

**시뮬레이터에서**:
1. `동기화 흐름` 탭 클릭
2. `TOBE 원본` 섹션에서 BOOK_ID=999 확인

**또는 터미널에서**:
```bash
docker exec tobe-oracle bash -c 'sqlplus -s tobe_user/tobe123@//localhost:1521/XEPDB1 << EOF
SELECT BOOK_ID, TITLE, AUTHOR_NAME, CATEGORY_CD, IS_ACTIVE
FROM TB_BOOK WHERE BOOK_ID = 999;
EOF'
```

**예상 결과**:
```
BOOK_ID  TITLE       AUTHOR_NAME  CATEGORY_CD  IS_ACTIVE
-------  ----------  -----------  -----------  ---------
999      테스트도서   테스트저자    LIT          1
```

### 2.3 스키마 변환 확인

| ASIS 입력값 | TOBE 결과값 | 변환 규칙 |
|------------|------------|----------|
| `BOOK_TITLE` = 테스트도서 | `TITLE` = 테스트도서 | 컬럼명 변환 |
| `CATEGORY` = 01 | `CATEGORY_CD` = LIT | 코드값 변환 |
| `STATUS` = Y | `IS_ACTIVE` = 1 | 코드값 변환 |

---

## 3. 테스트 2: TOBE → ASIS 동기화

### 3.1 TOBE에 데이터 추가

**터미널에서**:
```bash
docker exec tobe-oracle bash -c 'sqlplus -s tobe_user/tobe123@//localhost:1521/XEPDB1 << EOF
INSERT INTO TB_BOOK (BOOK_ID, TITLE, AUTHOR_NAME, CATEGORY_CD, IS_ACTIVE)
VALUES (888, '\''역방향테스트'\'', '\''저자B'\'', '\''SCI'\'', 1);
COMMIT;
EOF'
```

### 3.2 ASIS에서 확인

```bash
docker exec asis-oracle bash -c 'sqlplus -s asis_user/asis123@//localhost:1521/XEPDB1 << EOF
SELECT BOOK_ID, BOOK_TITLE, AUTHOR, CATEGORY, STATUS
FROM BOOK_INFO WHERE BOOK_ID = 888;
EOF'
```

**예상 결과**:
```
BOOK_ID  BOOK_TITLE   AUTHOR  CATEGORY  STATUS
-------  ----------   ------  --------  ------
888      역방향테스트  저자B    02        Y
```

### 3.3 역방향 스키마 변환 확인

| TOBE 입력값 | ASIS 결과값 | 변환 규칙 |
|------------|------------|----------|
| `TITLE` = 역방향테스트 | `BOOK_TITLE` = 역방향테스트 | 컬럼명 역변환 |
| `CATEGORY_CD` = SCI | `CATEGORY` = 02 | 코드값 역변환 |
| `IS_ACTIVE` = 1 | `STATUS` = Y | 코드값 역변환 |

---

## 4. 테스트 3: 동기화 흐름 추적

### 4.1 데이터 흐름 단계

```
ASIS 원본 → CDC_TOBE_BOOK → STAGING_TOBE_BOOK → TOBE 원본
   (1)           (2)              (3)             (4)
```

### 4.2 각 단계 확인 (시뮬레이터)

`동기화 흐름` 탭에서:

| 단계 | 테이블 | 설명 |
|------|--------|------|
| 1 | ASIS 원본 | INSERT한 데이터 |
| 2 | CDC | Kafka에서 받은 원본 데이터 |
| 3 | STAGING | 스키마 변환된 데이터 |
| 4 | TOBE 원본 | 최종 적용된 데이터 |

### 4.3 동기화 로그 확인

```bash
docker exec tobe-oracle bash -c 'sqlplus -s tobe_user/tobe123@//localhost:1521/XEPDB1 << EOF
SELECT LOG_TIME, TABLE_NAME, OPERATION, STATUS
FROM CDC_SYNC_LOG ORDER BY LOG_SEQ DESC FETCH FIRST 5 ROWS ONLY;
EOF'
```

---

## 5. 성공/실패 판단

### 5.1 성공 기준

- [ ] ASIS INSERT → TOBE에 데이터 생성됨
- [ ] TOBE INSERT → ASIS에 데이터 생성됨
- [ ] 스키마 변환이 정상적으로 적용됨 (코드값 변환)
- [ ] CDC_SYNC_LOG에 SUCCESS 기록됨

### 5.2 실패 시 확인사항

| 증상 | 확인 위치 | 해결 방법 |
|------|----------|----------|
| 데이터가 안 넘어옴 | 커넥터 상태 | `./scripts/register-connectors.sh` |
| CDC 테이블에만 있음 | STAGING 테이블 | 프로시저 상태 확인 |
| 코드 변환 안 됨 | 매핑 테이블 | SYNC_CODE_MAPPING 확인 |

---

## 6. 다음 단계

테스트가 성공했다면:

- **CDC 개념 이해하기** → [../01-개념/01_CDC_개념.md](../01-개념/01_CDC_개념.md)
- **아키텍처 이해하기** → [../01-개념/02_아키텍처_개요.md](../01-개념/02_아키텍처_개요.md)
- **더 많은 테스트** → [../04-운영/02_테스트_시나리오.md](../04-운영/02_테스트_시나리오.md)

---

*작성일: 2026-01-14*
