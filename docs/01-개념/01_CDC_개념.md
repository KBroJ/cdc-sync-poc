# CDC 개념

> **목표**: CDC가 무엇인지, 왜 필요한지 이해합니다.

---

## 1. CDC란?

### 1.1 정의

**CDC = Change Data Capture (변경 데이터 캡처)**

```
┌─────────────────────────────────────────────────────────────┐
│  데이터베이스에서 발생하는 모든 변경(INSERT, UPDATE, DELETE)을   │
│  실시간으로 감지하여 다른 시스템에 전달하는 기술                 │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 비유로 이해하기

```
┌─────────────────────────────────────────────────────────────┐
│  [CCTV 비유]                                                 │
│                                                             │
│  데이터베이스 = 창고                                          │
│  CDC = CCTV                                                 │
│  변경 이벤트 = 녹화 영상                                       │
│                                                             │
│  창고에서 물건이 들어오거나(INSERT), 바뀌거나(UPDATE),          │
│  나가면(DELETE) CCTV가 기록하듯이,                            │
│  CDC는 DB의 모든 변경을 기록하고 전달합니다.                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 기존 방식 vs CDC

### 2.1 기존 방식: 배치 동기화

```
[기존 방식의 문제]

사서가 ASIS에서 도서 등록 (09:00)
     ↓
     │ ← 2시간 대기 (배치 주기)
     ↓
TOBE에 데이터 반영 (11:00)
     ↓
"TOBE에는 왜 안 보이죠?" (09:30에 문의)
```

**문제점**:
- 데이터 지연이 길다 (분~시간 단위)
- 실시간 업무에 부적합
- 배치 실패 시 데이터 불일치

### 2.2 CDC 방식: 실시간 동기화

```
[CDC 방식]

사서가 ASIS에서 도서 등록 (09:00:00)
     ↓
     │ ← 수 초 이내
     ↓
TOBE에 데이터 반영 (09:00:03)
     ↓
TOBE에서도 바로 확인 가능!
```

**장점**:
- 실시간 동기화 (초 단위)
- 데이터 일관성 유지
- 비즈니스 연속성 보장

### 2.3 비교표

| 구분 | 배치 동기화 | CDC |
|------|-----------|-----|
| 동기화 주기 | 분~시간 | 초~밀리초 |
| 데이터 일관성 | 낮음 | 높음 |
| 시스템 부하 | 높음 (전체 스캔) | 낮음 (변경분만) |
| 실시간 업무 | 부적합 | 적합 |
| 구현 복잡도 | 낮음 | 중간 |

---

## 3. CDC 동작 원리

### 3.1 Oracle의 경우

```
┌─────────────────────────────────────────────────────────────┐
│                    Oracle CDC 동작 원리                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [1] INSERT INTO BOOK_INFO VALUES (...);                    │
│           ↓                                                 │
│  [2] Oracle이 Redo Log에 기록                                │
│           ↓                                                 │
│  [3] CDC 솔루션이 Redo Log를 읽음                             │
│           ↓                                                 │
│  [4] 변경 이벤트를 생성하여 전달                               │
│                                                             │
│  ┌─────────┐    ┌──────────┐    ┌─────────┐    ┌─────────┐ │
│  │ 애플리   │───▶│  Oracle   │───▶│  Redo   │───▶│   CDC   │ │
│  │ 케이션   │    │   DB     │    │  Log    │    │  Agent  │ │
│  └─────────┘    └──────────┘    └─────────┘    └─────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 Redo Log란?

```
Redo Log = Oracle의 모든 변경사항을 기록하는 로그 파일

목적:
- 장애 복구 (데이터베이스 크래시 시 복원)
- CDC (변경 추적)

특징:
- 모든 DML(INSERT, UPDATE, DELETE)이 기록됨
- 트랜잭션 순서대로 기록됨
```

### 3.3 CDC가 읽는 데이터

CDC 이벤트에는 다음 정보가 포함됩니다:

| 정보 | 설명 | 예시 |
|------|------|------|
| 연산 타입 | INSERT/UPDATE/DELETE | `INSERT` |
| 테이블명 | 변경된 테이블 | `BOOK_INFO` |
| 변경 전 값 | UPDATE/DELETE 시 | `{TITLE: "이전제목"}` |
| 변경 후 값 | INSERT/UPDATE 시 | `{TITLE: "새제목"}` |
| 타임스탬프 | 변경 시각 | `2026-01-14 09:00:00` |
| 트랜잭션 ID | 트랜잭션 식별자 | `txn-12345` |

---

## 4. 이 프로젝트에서 CDC가 필요한 이유

### 4.1 상황

```
┌─────────────────────────────────────────────────────────────┐
│  법원도서관에서 새로운 통합관리시스템을 구축 중입니다.            │
│                                                             │
│  - 기존 시스템(ASIS): 20년간 운영, 안정적                      │
│  - 신규 시스템(TOBE): 새 표준으로 구축 중                      │
│                                                             │
│  문제: 1차에서 일부 시스템만 전환 → ASIS/TOBE가 공존해야 함     │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 왜 양방향 동기화가 필요한가?

```
[시나리오 1] ASIS → TOBE

ASIS에서 도서 등록 (기존 시스템 사용자)
     ↓
CDC가 변경 감지
     ↓
TOBE에 자동 동기화 (신규 시스템에도 반영)


[시나리오 2] TOBE → ASIS

TOBE에서 도서 등록 (신규 시스템 사용자)
     ↓
CDC가 변경 감지
     ↓
ASIS에 자동 동기화 (기존 시스템에도 반영)
```

### 4.3 단순 복제가 불가능한 이유

두 시스템은 **스키마(데이터 구조)가 다릅니다**:

| 구분 | ASIS (구 시스템) | TOBE (신 시스템) |
|------|-----------------|--------------------|
| 테이블명 | `BOOK_INFO` | `TB_BOOK` |
| 제목 컬럼 | `BOOK_TITLE` | `TITLE` |
| 상태 컬럼 | `STATUS` (Y/N) | `IS_ACTIVE` (1/0) |
| 분류 코드 | `CATEGORY` (01, 02) | `CATEGORY_CD` (LIT, SCI) |

**→ CDC + 스키마 변환이 함께 필요합니다.**

---

## 5. CDC 솔루션 종류

### 5.1 대표적인 CDC 솔루션

| 솔루션 | 라이선스 | 특징 |
|--------|---------|------|
| **Debezium** | 오픈소스 | Kafka 기반, 무료, 활발한 커뮤니티 |
| Oracle GoldenGate | 상용 | Oracle 공식, 고성능, 고가 |
| AWS DMS | 상용 | AWS 클라우드 환경에 최적화 |
| Striim | 상용 | 실시간 데이터 통합 플랫폼 |
| HVR | 상용 | 대용량 데이터 처리 특화 |

### 5.2 이 프로젝트의 선택

```
┌─────────────────────────────────────────────────────────────┐
│  PoC(개념 증명)에서는 Debezium을 사용합니다.                    │
│                                                             │
│  이유:                                                       │
│  - 오픈소스 (비용 없음)                                       │
│  - Oracle 지원                                               │
│  - 커뮤니티 활발                                              │
│  - 학습 자료 풍부                                             │
│                                                             │
│  ※ 프로덕션에서는 다른 솔루션 선정 가능 (미정)                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. CDC의 어려운 점

### 6.1 무한루프 문제

양방향 동기화에서 발생하는 문제:

```
ASIS INSERT → TOBE 동기화
                    ↓
              TOBE 변경 발생
                    ↓
              ASIS 동기화
                    ↓
              ASIS 변경 발생
                    ↓
              TOBE 동기화 (무한 반복!)
```

**해결책**: 해시 기반 중복 감지 → [02_아키텍처_개요.md](02_아키텍처_개요.md)에서 설명

### 6.2 충돌 문제

양쪽에서 동시에 같은 데이터를 수정할 때:

```
09:00:00 - ASIS에서 BOOK_ID=100의 제목을 "A"로 수정
09:00:01 - TOBE에서 BOOK_ID=100의 제목을 "B"로 수정

어떤 값이 최종 값이어야 하는가?
```

**해결책**: LWW(Last Write Wins) 정책 → [../02-설계/03_충돌_정책.md](../02-설계/03_충돌_정책.md)에서 설명

---

## 7. 다음 단계

1. **아키텍처 이해** → [02_아키텍처_개요.md](02_아키텍처_개요.md)
2. **Debezium 상세** → [03_Debezium_핵심개념.md](03_Debezium_핵심개념.md)
3. **환경 시작하기** → [../00-시작하기/02_환경_시작_가이드.md](../00-시작하기/02_환경_시작_가이드.md)

---

*작성일: 2026-01-14*
