# CDC PoC ê°œë°œ ì§„í–‰ ê¸°ë¡

> ê°œë°œ ê³¼ì •ì—ì„œ ë°œìƒí•œ ë¬¸ì œì ê³¼ í•´ê²° ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### ëª©í‘œ
- Oracle ì–‘ë°©í–¥ CDC(Change Data Capture) ë™ê¸°í™” PoC
- ASIS DB(ê¸°ì¡´ ì‹œìŠ¤í…œ) â†” TOBE DB(ì‹ ê·œ ì‹œìŠ¤í…œ) ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”

### ê¸°ìˆ  ìŠ¤íƒ
| êµ¬ì„±ìš”ì†Œ | ê¸°ìˆ  |
|---------|------|
| Database | Oracle XE 21c Ã— 2 (Docker) |
| CDC | Debezium 2.4 (LogMiner ë°©ì‹) |
| Message Broker | Apache Kafka |
| Sync Service | Java 17 + Spring Boot 3.2 |
| Container | Docker Compose |

### ì•„í‚¤í…ì²˜
```
ASIS Oracle (1521)                          TOBE Oracle (1522)
     â”‚                                            â”‚
     â–¼                                            â–¼
Debezium Connector â”€â”€â–º Kafka â—„â”€â”€ Debezium Connector
                         â”‚
                         â–¼
                   Sync Service (8082)
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                         â–¼
     CDC_TOBE_BOOK              CDC_ASIS_BOOK
     (TOBE DB)                  (ASIS DB)
```

---

## 2. ë¬¸ì œì  ë° í•´ê²° ê³¼ì •

### 2.1 UPDATE í…ŒìŠ¤íŠ¸ ë°˜ë³µ ì‹¤í–‰ ì‹œ ì‹¤íŒ¨

#### ë¬¸ì œ í˜„ìƒ
- ëŒ€ì‹œë³´ë“œì—ì„œ UPDATE í…ŒìŠ¤íŠ¸ ì²« ë²ˆì§¸ëŠ” ì„±ê³µ
- ë‘ ë²ˆì§¸ë¶€í„° ê³„ì† ì‹¤íŒ¨
- ì—ëŸ¬: `ORA-17268: Year value is out of range`

#### ì›ì¸ ë¶„ì„
Debeziumì´ Oracle DATE/TIMESTAMPë¥¼ ì „ì†¡í•  ë•Œ ì—¬ëŸ¬ í˜•ì‹ ì‚¬ìš©:
- `io.debezium.time.MicroTimestamp`: **ë§ˆì´í¬ë¡œì´ˆ** (10^15 ë‹¨ìœ„)
- `io.debezium.time.Timestamp`: ë°€ë¦¬ì´ˆ (10^12 ë‹¨ìœ„)
- `io.debezium.time.Date`: epoch days (10^4 ë‹¨ìœ„)

ê¸°ì¡´ ì½”ë“œëŠ” ëª¨ë“  ê°’ì„ ë°€ë¦¬ì´ˆë¡œ ê°€ì •í•˜ê³  ì²˜ë¦¬:
```java
// ë¬¸ì œ ì½”ë“œ
return new Timestamp(epochValue);  // ë§ˆì´í¬ë¡œì´ˆ ê°’ì´ ë“¤ì–´ì˜¤ë©´ ì˜¤ë¥˜
```

ë§ˆì´í¬ë¡œì´ˆ ê°’(ì˜ˆ: `1768279886846975`)ì„ ë°€ë¦¬ì´ˆë¡œ ì²˜ë¦¬í•˜ë©´ ì—°ë„ê°€ `+58000ë…„`ì´ ë˜ì–´ Oracleì—ì„œ ì˜¤ë¥˜ ë°œìƒ.

#### í•´ê²° ë°©ë²•
ê°’ì˜ í¬ê¸°ë¡œ í˜•ì‹ì„ ìë™ íŒë³„í•˜ëŠ” ë¡œì§ ì¶”ê°€:

```java
private Timestamp convertEpochToTimestamp(long epochValue) {
    long epochMs;

    if (epochValue > 100_000_000_000_000L) {
        // ë§ˆì´í¬ë¡œì´ˆ (10^15 ì´ìƒ) -> ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
        epochMs = epochValue / 1000;
    } else if (epochValue < 100_000) {
        // ì¼ìˆ˜ (10^5 ë¯¸ë§Œ) -> ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
        epochMs = epochValue * 86400000L;
    } else {
        // ì´ë¯¸ ë°€ë¦¬ì´ˆ
        epochMs = epochValue;
    }

    return new Timestamp(epochMs);
}
```

#### íŒŒì¼ ìœ„ì¹˜
`sync-service-java/src/main/java/com/cdc/sync/service/CdcSyncService.java`

---

### 2.2 ì „ì†¡ëœ ë°ì´í„°ê°€ ì§¤ë ¤ì„œ í‘œì‹œë¨

#### ë¬¸ì œ í˜„ìƒ
- ëŒ€ì‹œë³´ë“œ "ì „ì†¡ëœ ë°ì´í„°" ì»¬ëŸ¼ì—ì„œ ë°ì´í„°ê°€ ì¤‘ê°„ì— `...`ìœ¼ë¡œ ì§¤ë¦¼
- ì „ì²´ ë‚´ìš© í™•ì¸ ë¶ˆê°€

#### ì›ì¸ ë¶„ì„
`createDataPreview()` ë©”ì„œë“œì—ì„œ ì˜ë„ì ìœ¼ë¡œ ë°ì´í„° ì¶•ì•½:
```java
// ë¬¸ì œ ì½”ë“œ
if (str.length() > 30) {
    valueStr = str.substring(0, 30) + "...";
}
if (count >= 5) {
    sb.append(", ...");
    break;  // 5ê°œ í•„ë“œë§Œ í‘œì‹œ
}
```

#### í•´ê²° ë°©ë²•
ì „ì²´ ë°ì´í„° í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •:
```java
private String createDataPreview(Map<String, Object> data) {
    StringBuilder sb = new StringBuilder();
    sb.append("{\n");
    int count = 0;
    for (Map.Entry<String, Object> entry : data.entrySet()) {
        if (count > 0) sb.append(",\n");
        String key = entry.getKey();
        Object value = entry.getValue();

        // ê°’ í¬ë§·íŒ… (ì „ì²´ í‘œì‹œ, ì§¤ë¦¼ ì—†ìŒ)
        String valueStr = (value instanceof String)
            ? "\"" + value + "\""
            : String.valueOf(value);

        sb.append("  ").append(key).append(": ").append(valueStr);
        count++;
        // break ì œê±° - ëª¨ë“  í•„ë“œ í‘œì‹œ
    }
    sb.append("\n}");
    return sb.toString();
}
```

UIì—ì„œëŠ” í´ë¦­í•˜ë©´ í¼ì³ì§€ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬:
```css
.data-cell.collapsed {
    max-height: 60px;
    overflow: hidden;
}
.data-cell.expanded {
    max-height: none;
}
```

---

### 2.3 í…Œì´ë¸” ìŠ¤í¬ë¡¤ ì‹œ í—¤ë”ë„ ê°™ì´ ìŠ¤í¬ë¡¤ë¨

#### ë¬¸ì œ í˜„ìƒ
- í…Œì´ë¸” ë°ì´í„°ê°€ ë§ì•„ì„œ ìŠ¤í¬ë¡¤í•˜ë©´ ì»¬ëŸ¼ëª…(í—¤ë”)ì´ ì‚¬ë¼ì§
- ì–´ë–¤ ì»¬ëŸ¼ì¸ì§€ í™•ì¸ ë¶ˆê°€

#### í•´ê²° ë°©ë²•
CSS `position: sticky` ì ìš©:
```css
.table-wrapper {
    max-height: 250px;
    overflow-y: auto;
}

th {
    position: sticky;
    top: 0;
    background: #0d0d1a;
    z-index: 10;
}
```

---

### 2.4 HTMLì´ Java íŒŒì¼ ì•ˆì— í¬í•¨ë¨

#### ë¬¸ì œ í˜„ìƒ
`DashboardController.java`ì—ì„œ HTMLì„ ë¬¸ìì—´ë¡œ ë°˜í™˜:
```java
@GetMapping("/dashboard")
@ResponseBody
public String dashboard() {
    return """
    <!DOCTYPE html>
    <html>
    ... ìˆ˜ë°± ì¤„ì˜ HTML ...
    </html>
    """;
}
```

#### ë¬¸ì œì 
- ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€ (HTML ìˆ˜ì •í•˜ë ¤ë©´ Java íŒŒì¼ ìˆ˜ì • í•„ìš”)
- IDEì—ì„œ HTML ë¬¸ë²• í•˜ì´ë¼ì´íŒ… ë¶ˆê°€
- í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì í˜‘ì—… ì–´ë ¤ì›€
- ë¹Œë“œ ì—†ì´ HTML ìˆ˜ì • ë¶ˆê°€

#### í•´ê²° ë°©ë²• (1ì°¨ - ì •ì  íŒŒì¼ ë¶„ë¦¬)
`src/main/resources/static/dashboard.html`ë¡œ ë¶„ë¦¬:
```java
@GetMapping("/dashboard")
public String dashboard() {
    return "redirect:/dashboard.html";
}
```

#### ê°œì„  ë°©í–¥ (2ì°¨ - Thymeleaf ì ìš© ì˜ˆì •)
Spring Boot í‘œì¤€ í…œí”Œë¦¿ ì—”ì§„ Thymeleaf ì‚¬ìš©:
- ë™ì  ë°ì´í„° ë°”ì¸ë”© ê°€ëŠ¥
- ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§
- `src/main/resources/templates/` ì‚¬ìš©

---

### 2.5 Java ì£¼ì„ì— HTML íƒœê·¸ í¬í•¨

#### ë¬¸ì œ í˜„ìƒ
Javadoc ì£¼ì„ì— HTML íƒœê·¸ ì‚¬ìš©:
```java
/**
 * <p>ì„¤ëª…ì…ë‹ˆë‹¤.</p>
 * <ul>
 *   <li>í•­ëª©1</li>
 *   <li>í•­ëª©2</li>
 * </ul>
 */
```

#### ë¬¸ì œì 
- ì½”ë“œ ê°€ë…ì„± ì €í•˜
- IDEì—ì„œ ì£¼ì„ ì½ê¸° ë¶ˆí¸

#### í•´ê²° ë°©ë²•
ì¼ë°˜ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€ê²½:
```java
/**
 * ì„¤ëª…ì…ë‹ˆë‹¤.
 *
 * í•­ëª©:
 *   - í•­ëª©1
 *   - í•­ëª©2
 */
```

#### ìˆ˜ì •í•œ íŒŒì¼ ëª©ë¡
- `DataSourceConfig.java`
- `KafkaConfig.java`
- `CdcEvent.java`
- `CdcKafkaConsumer.java`
- `CdcMonitoringService.java`
- `MonitoringController.java`
- `CdcSyncService.java`
- `TestController.java`

---

### 2.6 CDC í…Œì´ë¸”ì—ë§Œ INSERTë˜ê³  ì‹¤ì œ í…Œì´ë¸” ë™ê¸°í™” ì•ˆë¨

#### ë¬¸ì œ í˜„ìƒ
- ASIS BOOK_INFO ë³€ê²½ â†’ CDC_TOBE_BOOKì— INSERTë¨
- í•˜ì§€ë§Œ TB_BOOKì€ ë³€ê²½ ì•ˆë¨
- ëŒ€ì‹œë³´ë“œì—ì„œ ASISì™€ TOBEì˜ BOOK_TITLEì´ ë‹¤ë¥´ê²Œ í‘œì‹œ

#### ì›ì¸ ë¶„ì„
í˜„ì¬ CDC íë¦„:
```
ASIS BOOK_INFO ë³€ê²½
    â†’ Debezium ê°ì§€
    â†’ Kafka ì „ì†¡
    â†’ Sync Service ìˆ˜ì‹ 
    â†’ CDC_TOBE_BOOK INSERT (ì—¬ê¸°ê¹Œì§€ë§Œ êµ¬í˜„)
    â†’ TB_BOOK ë°˜ì˜ (ë¯¸êµ¬í˜„!)
```

CDC í…Œì´ë¸”ì€ "ì´ë²¤íŠ¸ ì €ì¥ì†Œ"ì¼ ë¿, ì‹¤ì œ í…Œì´ë¸” ë™ê¸°í™”ëŠ” ë³„ë„ êµ¬í˜„ í•„ìš”.

#### í•´ê²° ë°©í–¥ (ì§„í–‰ ì˜ˆì •)
1. CDC ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ ì‹¤ì œ í…Œì´ë¸”ì— CUD ìˆ˜í–‰
2. ê·¸ í›„ CDC í…Œì´ë¸”ì— ê¸°ë¡ (ë¡œê¹…ìš©)
3. ìŠ¤í‚¤ë§ˆ ë§¤í•‘ ì ìš© (BOOK_TITLE â†” TITLE ë“±)

ì˜¬ë°”ë¥¸ ìˆœì„œ:
```
CDC ì´ë²¤íŠ¸ ìˆ˜ì‹ 
    â†’ ì‹¤ì œ í…Œì´ë¸” CUD (TB_BOOK INSERT/UPDATE/DELETE)
    â†’ CDC í…Œì´ë¸” ê¸°ë¡ (CDC_TOBE_BOOK INSERT)
```

---

## 3. ìŠ¤í‚¤ë§ˆ ë§¤í•‘

ASISì™€ TOBEì˜ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë¯€ë¡œ ë³€í™˜ í•„ìš”:

| ASIS (BOOK_INFO) | TOBE (TB_BOOK) | ë³€í™˜ |
|------------------|----------------|------|
| BOOK_ID | BOOK_ID | ë™ì¼ |
| BOOK_TITLE | TITLE | ì»¬ëŸ¼ëª… ë³€ê²½ |
| AUTHOR | AUTHOR_NAME | ì»¬ëŸ¼ëª… ë³€ê²½ |
| CATEGORY | CATEGORY_CD | ì»¬ëŸ¼ëª… ë³€ê²½ |
| STATUS (Y/N) | IS_ACTIVE (1/0) | ê°’ ë³€í™˜ |
| REG_DATE | CREATED_AT | ì»¬ëŸ¼ëª… ë³€ê²½ |
| MOD_DATE | UPDATED_AT | ì»¬ëŸ¼ëª… ë³€ê²½ |

---

## 4. í…ŒìŠ¤íŠ¸ API ì¶”ê°€

### ì¶”ê°€ëœ ì—”ë“œí¬ì¸íŠ¸

| Method | URL | ì„¤ëª… |
|--------|-----|------|
| POST | /api/test/asis/insert | ASIS DB INSERT í…ŒìŠ¤íŠ¸ |
| POST | /api/test/asis/update | ASIS DB UPDATE í…ŒìŠ¤íŠ¸ |
| POST | /api/test/asis/delete | ASIS DB DELETE í…ŒìŠ¤íŠ¸ |
| POST | /api/test/tobe/insert | TOBE DB INSERT í…ŒìŠ¤íŠ¸ |
| POST | /api/test/tobe/update | TOBE DB UPDATE í…ŒìŠ¤íŠ¸ |
| POST | /api/test/tobe/delete | TOBE DB DELETE í…ŒìŠ¤íŠ¸ |
| GET | /api/test/asis/data | ASIS ì›ë³¸ í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/test/tobe/data | TOBE ì›ë³¸ í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/test/asis/cdc | ASIS CDC í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/test/tobe/cdc | TOBE CDC í…Œì´ë¸” ì¡°íšŒ |

### ì‘ë‹µ ì˜ˆì‹œ (UPDATE)
```json
{
  "success": true,
  "operation": "UPDATE",
  "message": "ASIS DB UPDATE ì™„ë£Œ",
  "sql": "UPDATE BOOK_INFO SET BOOK_TITLE = ?, MOD_DATE = SYSDATE WHERE BOOK_ID = ?",
  "beforeData": {
    "BOOK_ID": 1,
    "BOOK_TITLE": "ê¸°ì¡´ì œëª©",
    "AUTHOR": "ì €ìëª…"
  },
  "afterData": {
    "BOOK_ID": 1,
    "BOOK_TITLE": "ë³€ê²½ëœì œëª©",
    "AUTHOR": "ì €ìëª…"
  },
  "rowsAffected": 1,
  "targetCdcTable": "CDC_TOBE_BOOK"
}
```

---

## 5. íŒŒì¼ êµ¬ì¡°

```
sync-service-java/
â”œâ”€â”€ src/main/java/com/cdc/sync/
â”‚   â”œâ”€â”€ SyncServiceApplication.java      # ë©”ì¸ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ DataSourceConfig.java        # ë‹¤ì¤‘ ë°ì´í„°ì†ŒìŠ¤ ì„¤ì •
â”‚   â”‚   â””â”€â”€ KafkaConfig.java             # Kafka Consumer ì„¤ì •
â”‚   â”œâ”€â”€ consumer/
â”‚   â”‚   â””â”€â”€ CdcKafkaConsumer.java        # Kafka ë¦¬ìŠ¤ë„ˆ
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ CdcEvent.java                # CDC ì´ë²¤íŠ¸ ëª¨ë¸
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ CdcSyncService.java          # ë™ê¸°í™” ì„œë¹„ìŠ¤ (í•µì‹¬)
â”‚   â””â”€â”€ monitoring/
â”‚       â”œâ”€â”€ CdcMonitoringService.java    # í†µê³„/ë¡œê¹…
â”‚       â”œâ”€â”€ MonitoringController.java    # ëª¨ë‹ˆí„°ë§ API
â”‚       â”œâ”€â”€ TestController.java          # í…ŒìŠ¤íŠ¸ API
â”‚       â””â”€â”€ DashboardController.java     # ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml                  # ì„¤ì • íŒŒì¼
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ dashboard.html               # ëŒ€ì‹œë³´ë“œ UI
â””â”€â”€ pom.xml
```

---

## 6. ë‚¨ì€ ì‘ì—…

### 6.1 ì‹¤ì œ í…Œì´ë¸” ë™ê¸°í™” êµ¬í˜„
- [ ] CDC ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ ì‹¤ì œ í…Œì´ë¸” CUD ìˆ˜í–‰
- [ ] ìŠ¤í‚¤ë§ˆ ë§¤í•‘ ì ìš© (ASIS â†” TOBE ì»¬ëŸ¼ ë³€í™˜)
- [ ] ë¬´í•œë£¨í”„ ë°©ì§€ ë¡œì§ (í•´ì‹œ ê¸°ë°˜)

### 6.2 Thymeleaf ì ìš©
- [ ] pom.xmlì— ì˜ì¡´ì„± ì¶”ê°€
- [ ] templates/ í´ë”ë¡œ HTML ì´ë™
- [ ] ë™ì  ë°ì´í„° ë°”ì¸ë”©

---

## 7. ì°¸ê³  ì‚¬í•­

### Debezium íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹
| í˜•ì‹ | ê°’ ë²”ìœ„ | ì˜ˆì‹œ |
|------|---------|------|
| MicroTimestamp | 10^15 ì´ìƒ | 1768279886846975 |
| Timestamp (ms) | 10^12 ~ 10^15 | 1768279886846 |
| Date (days) | 10^5 ë¯¸ë§Œ | 19736 (2024-01-13) |

### Debezium NUMBER í˜•ì‹
Oracle NUMBERëŠ” Base64 ì¸ì½”ë”©ëœ BigIntegerë¡œ ì „ì†¡:
```json
{ "scale": 0, "value": "AQ==" }
```

ë””ì½”ë”© ë¡œì§:
```java
byte[] bytes = Base64.getDecoder().decode("AQ==");
BigInteger bigInt = new BigInteger(bytes);  // ê²°ê³¼: 1
```

---

## 8. ì»¤ë°‹ íˆìŠ¤í† ë¦¬

| ë‚ ì§œ | ë‚´ìš© |
|------|------|
| 2026-01-13 | ì´ˆê¸° PoC í™˜ê²½ êµ¬ì¶• |
| 2026-01-13 | Sync Service Python â†’ Java ì „í™˜ |
| 2026-01-13 | ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì¶”ê°€ |
| 2026-01-13 | UPDATE ë°˜ë³µ ì‹¤íŒ¨ ë²„ê·¸ ìˆ˜ì • (íƒ€ì„ìŠ¤íƒ¬í”„) |
| 2026-01-13 | INSERT/UPDATE/DELETE í…ŒìŠ¤íŠ¸ API ì¶”ê°€ |
| 2026-01-13 | HTML ë¶„ë¦¬, ì£¼ì„ ì •ë¦¬ |
| 2026-01-13 | Oracle Scheduler Job ì¶”ê°€ (TOBE/ASIS ì–‘ìª½) |
| 2026-01-13 | Docker init ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • (PDB ì „í™˜, ìŠ¤í‚¤ë§ˆ ì „í™˜) |
| 2026-01-13 | í”„ë¡œì‹œì € SQLERRM ì˜¤ë¥˜ ìˆ˜ì • |

---

## 9. TODO (í•´ì•¼ í•  ì‘ì—…)

### 9.1 í•„ìˆ˜ ì‘ì—…

| ìˆœì„œ | ì‘ì—… | ìƒíƒœ | ì„¤ëª… |
|:----:|------|:----:|------|
| 1 | WORKER í”„ë¡œì‹œì € í˜¸ì¶œ ì„¤ì • | âœ… | Oracle Scheduler Job ì¶”ê°€ ì™„ë£Œ |
| 2 | ASIS DB í”„ë¡œì‹œì € ìƒì„± | âœ… | ì´ë¯¸ ì¡´ì¬, Scheduler Job ì¶”ê°€ ì™„ë£Œ |
| 3 | Docker ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • | âœ… | PDB ì „í™˜, ìŠ¤í‚¤ë§ˆ ì „í™˜, SQLERRM ìˆ˜ì • |
| 4 | ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸ | ğŸ”„ | Docker ì¬ì‹œì‘ í›„ í…ŒìŠ¤íŠ¸ í•„ìš” |

### 9.2 ì„ íƒ ì‘ì—… â†’ ëŒ€ì‹œë³´ë“œ ê°œì„  (ì™„ë£Œ)

| ìˆœì„œ | ì‘ì—… | ìƒíƒœ | ì„¤ëª… |
|:----:|------|:----:|------|
| 4 | Thymeleaf ì ìš© | âœ… | static HTML â†’ í…œí”Œë¦¿ ì—”ì§„ |
| 5 | ëŒ€ì‹œë³´ë“œ ê°œì„  | âœ… | CDC ë™ê¸°í™” ì‹œë®¬ë ˆì´í„°ë¡œ ì „í™˜ |

> **ìƒì„¸ ê³„íš**: `17_ëŒ€ì‹œë³´ë“œ_ê°œì„ _ê³„íš.md` ì°¸ì¡°

### 9.3 ì‘ì—… ìƒì„¸

#### 1. WORKER í”„ë¡œì‹œì € í˜¸ì¶œ ì„¤ì •

**ë¬¸ì œ**: `SP_WORKER_BOOK` í”„ë¡œì‹œì €ê°€ ì¡´ì¬í•˜ì§€ë§Œ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ì•ˆ** (íƒ1):
- **ë°©ì•ˆ A**: Oracle Scheduler ì„¤ì • (ì£¼ê¸°ì  ì‹¤í–‰)
- **ë°©ì•ˆ B**: Java Sync Serviceì—ì„œ í”„ë¡œì‹œì € í˜¸ì¶œ ì¶”ê°€
- **ë°©ì•ˆ C**: CDC í…Œì´ë¸” INSERT íŠ¸ë¦¬ê±°ë¡œ ìë™ í˜¸ì¶œ

**ê´€ë ¨ íŒŒì¼**:
- `poc/tobe-oracle/init/04_create_procedures.sql` - í”„ë¡œì‹œì € ì •ì˜
- `sync-service-java/.../CdcSyncService.java` - CDC í…Œì´ë¸” INSERT

#### 2. ASIS DB í”„ë¡œì‹œì € ìƒì„±

TOBE DBì—ë§Œ í”„ë¡œì‹œì €ê°€ ìˆìŒ. ASIS DBì—ë„ ë™ì¼í•˜ê²Œ í•„ìš”:
- `SP_WORKER_BOOK` (CDC_ASIS_BOOK â†’ BOOK_INFO)
- `FN_CONVERT_CODE` (ì½”ë“œ ì—­ë³€í™˜)
- `FN_IS_LOOP`, `FN_GENERATE_HASH`

**ìƒì„± ìœ„ì¹˜**: `poc/asis-oracle/init/04_create_procedures.sql`

---

## 10. Oracle Scheduler ì„¤ì • (2026-01-13)

### 10.1 ë¬¸ì œì 
- WORKER í”„ë¡œì‹œì €ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì•„ë¬´ë„ í˜¸ì¶œí•˜ì§€ ì•Šì•„ ë™ê¸°í™” ì•ˆ ë¨
- CDC_TOBE_BOOKì— ë°ì´í„°ëŠ” ë“¤ì–´ê°€ì§€ë§Œ TB_BOOKì— ë°˜ì˜ ì•ˆ ë¨

### 10.2 í•´ê²°: Oracle Scheduler Job ì¶”ê°€

```sql
-- 5ì´ˆë§ˆë‹¤ WORKER í”„ë¡œì‹œì € ìë™ ì‹¤í–‰
BEGIN
    DBMS_SCHEDULER.CREATE_JOB(
        job_name        => 'JOB_CDC_WORKER',
        job_type        => 'PLSQL_BLOCK',
        job_action      => 'BEGIN SP_RUN_ALL_WORKERS; END;',
        start_date      => SYSTIMESTAMP,
        repeat_interval => 'FREQ=SECONDLY;INTERVAL=5',
        enabled         => TRUE
    );
END;
```

### 10.3 Docker init ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •ì‚¬í•­

1. **00_setup_user.sql ì¶”ê°€**: ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬
2. **PDB ì „í™˜ ì¶”ê°€**: `ALTER SESSION SET CONTAINER = XEPDB1;`
3. **ìŠ¤í‚¤ë§ˆ ì „í™˜ ì¶”ê°€**: `ALTER SESSION SET CURRENT_SCHEMA = TOBE_USER;`
4. **SQLERRM ì˜¤ë¥˜ ìˆ˜ì •**: `SUBSTR(SQLERRM, 1, 500)` ì‚¬ìš©

### 10.4 ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡
- `poc/tobe-oracle/init/00_setup_user.sql` (ì‹ ê·œ)
- `poc/tobe-oracle/init/01~05_*.sql` (PDB/ìŠ¤í‚¤ë§ˆ ì „í™˜ ì¶”ê°€)
- `poc/tobe-oracle/init/04_create_procedures.sql` (Scheduler Job, SQLERRM ìˆ˜ì •)
- `poc/asis-oracle/init/00_setup_user.sql` (ì‹ ê·œ)
- `poc/asis-oracle/init/01~05_*.sql` (PDB/ìŠ¤í‚¤ë§ˆ ì „í™˜ ì¶”ê°€)
- `poc/asis-oracle/init/04_create_procedures.sql` (Scheduler Job, SQLERRM ìˆ˜ì •)

### 10.5 ë‹¤ìŒ ì‘ì—…
- Docker ì¬ì‹œì‘ í›„ í…Œì´ë¸”/í”„ë¡œì‹œì € ìƒì„± í™•ì¸
- Scheduler Job ì‹¤í–‰ ìƒíƒœ í™•ì¸
- CDC ì „ì²´ íë¦„ í…ŒìŠ¤íŠ¸ (ASIS â†’ TOBE â†’ TB_BOOK ë™ê¸°í™”)

---

## 11. Debezium ì„¤ì • ë° ì „ì²´ CDC íë¦„ í…ŒìŠ¤íŠ¸ (2026-01-13)

### 11.1 Docker í™˜ê²½ ì‹œì‘ - í¬íŠ¸ ì¶©ëŒ ë¬¸ì œ

#### ë¬¸ì œ í˜„ìƒ
```
Error response from daemon: ports are not available: exposing port TCP 0.0.0.0:1521 -> 127.0.0.1:0:
listen tcp 0.0.0.0:1521: bind: An attempt was made to access a socket in a way forbidden by its access permissions.
```

Docker Desktop ì¬ì‹œì‘ í›„ì—ë„ 1521, 1522 í¬íŠ¸ ì‚¬ìš© ë¶ˆê°€.

#### ì›ì¸ ë¶„ì„
Windows Hyper-V ë˜ëŠ” NAT ì„œë¹„ìŠ¤ê°€ íŠ¹ì • í¬íŠ¸ ë²”ìœ„ë¥¼ ì˜ˆì•½í•˜ì—¬ ì‚¬ìš© ë¶ˆê°€ëŠ¥.
`netsh interface ipv4 show excludedportrange protocol=tcp` ëª…ë ¹ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥.

#### í•´ê²° ë°©ë²•
docker-compose.ymlì˜ í¬íŠ¸ë¥¼ ë†’ì€ ë²ˆí˜¸ë¡œ ë³€ê²½:
```yaml
# ë³€ê²½ ì „
asis-oracle:
  ports:
    - "1521:1521"
tobe-oracle:
  ports:
    - "1522:1521"

# ë³€ê²½ í›„
asis-oracle:
  ports:
    - "15210:1521"
tobe-oracle:
  ports:
    - "15220:1521"
```

#### ìˆ˜ì • íŒŒì¼
- `poc/docker-compose.yml`

---

### 11.2 Debezium ì„¤ì • - ARCHIVELOG ëª¨ë“œ í™œì„±í™”

#### ë¬¸ì œ í˜„ìƒ
Debezium Oracle LogMiner ì»¤ë„¥í„°ëŠ” ARCHIVELOG ëª¨ë“œ í•„ìˆ˜.
Oracle XE ê¸°ë³¸ ì„¤ì •ì€ NOARCHIVELOG ëª¨ë“œ.

#### í™•ì¸ ë°©ë²•
```sql
SELECT LOG_MODE FROM V$DATABASE;
-- ê²°ê³¼: NOARCHIVELOG
```

#### í•´ê²° ë°©ë²•
Oracleì„ MOUNT ìƒíƒœì—ì„œ ARCHIVELOG ëª¨ë“œë¡œ ë³€ê²½:

```bash
docker exec asis-oracle bash -c 'export ORACLE_SID=XE && sqlplus -s / as sysdba << EOF
SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
ALTER DATABASE ARCHIVELOG;
ALTER DATABASE OPEN;
ALTER PLUGGABLE DATABASE ALL OPEN;
exit;
EOF'
```

#### ì ìš© ëŒ€ìƒ
- ASIS Oracle (asis-oracle ì»¨í…Œì´ë„ˆ)
- TOBE Oracle (tobe-oracle ì»¨í…Œì´ë„ˆ)

---

### 11.3 Debezium ì„¤ì • - c##dbzuser ìƒì„±

#### í•„ìš”ì„±
Debezium Oracle ì»¤ë„¥í„°ê°€ LogMinerë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ íŠ¹ë³„í•œ ê¶Œí•œì„ ê°€ì§„ Common User í•„ìš”.

#### ìƒì„± ìŠ¤í¬ë¦½íŠ¸
```sql
-- CDB ë ˆë²¨ì—ì„œ ì‹¤í–‰ (SYSDBAë¡œ)
CREATE USER c##dbzuser IDENTIFIED BY dbz
  DEFAULT TABLESPACE USERS
  QUOTA UNLIMITED ON USERS
  CONTAINER=ALL;

-- í•„ìˆ˜ ê¶Œí•œ ë¶€ì—¬
GRANT CREATE SESSION TO c##dbzuser CONTAINER=ALL;
GRANT SET CONTAINER TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$DATABASE TO c##dbzuser CONTAINER=ALL;
GRANT FLASHBACK ANY TABLE TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ANY TABLE TO c##dbzuser CONTAINER=ALL;
GRANT SELECT_CATALOG_ROLE TO c##dbzuser CONTAINER=ALL;
GRANT EXECUTE_CATALOG_ROLE TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ANY TRANSACTION TO c##dbzuser CONTAINER=ALL;
GRANT LOGMINING TO c##dbzuser CONTAINER=ALL;
GRANT CREATE TABLE TO c##dbzuser CONTAINER=ALL;
GRANT LOCK ANY TABLE TO c##dbzuser CONTAINER=ALL;
GRANT CREATE SEQUENCE TO c##dbzuser CONTAINER=ALL;
GRANT EXECUTE ON DBMS_LOGMNR TO c##dbzuser CONTAINER=ALL;
GRANT EXECUTE ON DBMS_LOGMNR_D TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOG TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOG_HISTORY TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOGMNR_LOGS TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOGMNR_CONTENTS TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOGMNR_PARAMETERS TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$LOGFILE TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$ARCHIVED_LOG TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$ARCHIVE_DEST_STATUS TO c##dbzuser CONTAINER=ALL;
GRANT SELECT ON V_$TRANSACTION TO c##dbzuser CONTAINER=ALL;
```

#### Supplemental Logging í™œì„±í™”
```sql
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;
```

---

### 11.4 Debezium ì»¤ë„¥í„° ë“±ë¡ - CONTINUOUS_MINE ì˜¤ë¥˜

#### ë¬¸ì œ í˜„ìƒ
ì»¤ë„¥í„° ë“±ë¡ í›„ Task FAILED:
```
ORA-44609: CONTINOUS_MINE is desupported for use with DBMS_LOGMNR.START_LOGMNR.
```

#### ì›ì¸ ë¶„ì„
Oracle 21cì—ì„œ `CONTINUOUS_MINE` ì˜µì…˜ì´ ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŒ (deprecated).
Debezium ì„¤ì •ì—ì„œ `log.mining.continuous.mine: true` ì˜µì…˜ ì œê±° í•„ìš”.

#### í•´ê²° ë°©ë²•
ì»¤ë„¥í„° ì„¤ì •ì—ì„œ `log.mining.continuous.mine` ì˜µì…˜ ì œê±°:

```bash
# ASIS ì»¤ë„¥í„° ë“±ë¡
curl -X POST http://localhost:8083/connectors -H "Content-Type: application/json" -d '{
  "name": "asis-connector",
  "config": {
    "connector.class": "io.debezium.connector.oracle.OracleConnector",
    "tasks.max": "1",
    "database.hostname": "asis-oracle",
    "database.port": "1521",
    "database.user": "c##dbzuser",
    "database.password": "dbz",
    "database.dbname": "XE",
    "database.pdb.name": "XEPDB1",
    "topic.prefix": "asis",
    "table.include.list": "ASIS_USER.BOOK_INFO,ASIS_USER.MEMBER_INFO,ASIS_USER.LEGACY_CODE",
    "schema.history.internal.kafka.bootstrap.servers": "kafka:29092",
    "schema.history.internal.kafka.topic": "schema-changes.asis",
    "log.mining.strategy": "online_catalog"
  }
}'

# TOBE ì»¤ë„¥í„° ë“±ë¡
curl -X POST http://localhost:8083/connectors -H "Content-Type: application/json" -d '{
  "name": "tobe-connector",
  "config": {
    "connector.class": "io.debezium.connector.oracle.OracleConnector",
    "tasks.max": "1",
    "database.hostname": "tobe-oracle",
    "database.port": "1521",
    "database.user": "c##dbzuser",
    "database.password": "dbz",
    "database.dbname": "XE",
    "database.pdb.name": "XEPDB1",
    "topic.prefix": "tobe",
    "table.include.list": "TOBE_USER.TB_BOOK,TOBE_USER.TB_MEMBER,TOBE_USER.TB_NEW_SERVICE",
    "schema.history.internal.kafka.bootstrap.servers": "kafka:29092",
    "schema.history.internal.kafka.topic": "schema-changes.tobe",
    "log.mining.strategy": "online_catalog"
  }
}'
```

#### ì»¤ë„¥í„° ìƒíƒœ í™•ì¸
```bash
curl -s http://localhost:8083/connectors/asis-connector/status
curl -s http://localhost:8083/connectors/tobe-connector/status
# ê²°ê³¼: {"connector":{"state":"RUNNING"}, "tasks":[{"state":"RUNNING"}]}
```

---

### 11.5 SP_WORKER_BOOK í”„ë¡œì‹œì € - SQLERRM ë²„ê·¸ ìˆ˜ì •

#### ë¬¸ì œ í˜„ìƒ
WORKER í”„ë¡œì‹œì € í˜¸ì¶œ ì‹œ ì˜¤ë¥˜:
```
ORA-06550: PLS-00905: object TOBE_USER.SP_WORKER_BOOK is invalid
```

#### ì›ì¸ ë¶„ì„
í”„ë¡œì‹œì € ì»´íŒŒì¼ ì˜¤ë¥˜:
```
PL/SQL: ORA-00904: "SQLERRM": invalid identifier
```

`SQLERRM`ì€ PL/SQL ì˜ˆì•½ì–´ë¡œ, UPDATE ë¬¸ ì•ˆì—ì„œ ì§ì ‘ ì‚¬ìš© ë¶ˆê°€.

#### ë¬¸ì œ ì½”ë“œ
```sql
EXCEPTION
    WHEN OTHERS THEN
        UPDATE CDC_TOBE_BOOK
        SET PROCESSED_YN = 'E',
            ERROR_MSG = SUBSTR(SQLERRM, 1, 500)  -- ì˜¤ë¥˜!
        WHERE CDC_SEQ = rec.CDC_SEQ;
```

#### í•´ê²° ë°©ë²•
SQLERRMì„ ë¨¼ì € ë³€ìˆ˜ì— ì €ì¥ í›„ ì‚¬ìš©:

```sql
IS
    v_err_msg VARCHAR2(500);  -- ë³€ìˆ˜ ì„ ì–¸
BEGIN
    ...
EXCEPTION
    WHEN OTHERS THEN
        v_err_msg := SUBSTR(SQLERRM, 1, 500);  -- ë³€ìˆ˜ì— ì €ì¥
        UPDATE CDC_TOBE_BOOK
        SET PROCESSED_YN = 'E',
            ERROR_MSG = v_err_msg  -- ë³€ìˆ˜ ì‚¬ìš©
        WHERE CDC_SEQ = rec.CDC_SEQ;
```

#### ìˆ˜ì • ëŒ€ìƒ
- TOBE: `SP_WORKER_BOOK`, `SP_WORKER_MEMBER`, `SP_WORKER_LEGACY_CODE`
- ASIS: `SP_WORKER_BOOK`, `SP_WORKER_MEMBER`, `SP_WORKER_NEW_SERVICE`

---

### 11.6 CDC_ASIS_BOOK í…Œì´ë¸” - ì»¬ëŸ¼ ëˆ„ë½

#### ë¬¸ì œ í˜„ìƒ
TOBE â†’ ASIS ë™ê¸°í™” ì‹œ ì˜¤ë¥˜:
```
ORA-00904: "UPDATED_BY": invalid identifier
```

#### ì›ì¸ ë¶„ì„
TB_BOOK í…Œì´ë¸”ì—ëŠ” `CREATED_AT`, `UPDATED_AT`, `CREATED_BY`, `UPDATED_BY` ì»¬ëŸ¼ì´ ìˆì§€ë§Œ,
CDC_ASIS_BOOK í…Œì´ë¸”ì—ëŠ” í•´ë‹¹ ì»¬ëŸ¼ì´ ì—†ìŒ.

Debeziumì€ ì›ë³¸ í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ ì „ì†¡í•˜ê³ ,
Sync ServiceëŠ” ë™ì  SQLë¡œ ëª¨ë“  ì»¬ëŸ¼ì„ INSERTí•˜ë ¤ê³  ì‹œë„.

#### í•´ê²° ë°©ë²•
CDC_ASIS_BOOKì— ëˆ„ë½ëœ ì»¬ëŸ¼ ì¶”ê°€:

```sql
ALTER TABLE CDC_ASIS_BOOK ADD (
    CREATED_AT TIMESTAMP,
    UPDATED_AT TIMESTAMP,
    CREATED_BY VARCHAR2(50),
    UPDATED_BY VARCHAR2(50)
);
```

---

### 11.7 ì „ì²´ CDC íë¦„ í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### í…ŒìŠ¤íŠ¸ í™˜ê²½
| êµ¬ì„±ìš”ì†Œ | ìƒíƒœ |
|---------|:----:|
| ASIS Oracle (15210) | âœ… Running |
| TOBE Oracle (15220) | âœ… Running |
| Kafka | âœ… Running |
| Kafka Connect | âœ… Running |
| Debezium ASIS Connector | âœ… Running |
| Debezium TOBE Connector | âœ… Running |
| Sync Service (8082) | âœ… Running |

#### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 1: ASIS â†’ TOBE

```
[í…ŒìŠ¤íŠ¸]
curl -X POST http://localhost:8082/api/test/asis/insert
â†’ ASIS BOOK_INFOì— BOOK_ID=5 INSERT

[íë¦„]
1. Debeziumì´ BOOK_INFO ë³€ê²½ ê°ì§€
2. Kafka asis.ASIS_USER.BOOK_INFO í† í”½ìœ¼ë¡œ ë°œí–‰
3. Sync Serviceê°€ consume
4. CDC_TOBE_BOOKì— INSERT (PROCESSED_YN='N')
5. Oracle Scheduler Jobì´ SP_WORKER_BOOK í˜¸ì¶œ
6. STAGING_TOBE_BOOKì— ìŠ¤í‚¤ë§ˆ ë³€í™˜ í›„ INSERT
7. TB_BOOKì— ìµœì¢… ë°˜ì˜

[ê²°ê³¼]
- CDC_TOBE_BOOK: PROCESSED_YN='Y' âœ…
- TB_BOOK: BOOK_ID=5 ì¡´ì¬ âœ…
```

#### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 2: TOBE â†’ ASIS

```
[í…ŒìŠ¤íŠ¸]
curl -X POST http://localhost:8082/api/test/tobe/insert
â†’ TOBE TB_BOOKì— BOOK_ID=7 INSERT

[íë¦„]
1. Debeziumì´ TB_BOOK ë³€ê²½ ê°ì§€
2. Kafka tobe.TOBE_USER.TB_BOOK í† í”½ìœ¼ë¡œ ë°œí–‰
3. Sync Serviceê°€ consume
4. CDC_ASIS_BOOKì— INSERT (PROCESSED_YN='N')
5. Oracle Scheduler Jobì´ SP_WORKER_BOOK í˜¸ì¶œ
6. STAGING_ASIS_BOOKì— ìŠ¤í‚¤ë§ˆ ë³€í™˜ í›„ INSERT
7. BOOK_INFOì— ìµœì¢… ë°˜ì˜

[ê²°ê³¼]
- CDC_ASIS_BOOK: PROCESSED_YN='Y' âœ…
- BOOK_INFO: BOOK_ID=7 ì¡´ì¬ âœ…
```

#### ìµœì¢… ë°ì´í„° ìƒíƒœ
| DB | í…Œì´ë¸” | ê±´ìˆ˜ | ë¹„ê³  |
|:--:|:------:|:----:|------|
| ASIS | BOOK_INFO | 6ê±´ | 1,2,3,4,5 + 7(TOBEì—ì„œ ë™ê¸°í™”) |
| TOBE | TB_BOOK | 7ê±´ | 1,2,3 + 4,5(ASISì—ì„œ ë™ê¸°í™”) + 6,7 |

---

### 11.8 Docker ì¬ì‹œì‘ ì‹œ ì ìš© í•„ìš” í•­ëª©

í˜„ì¬ ìˆ˜ë™ìœ¼ë¡œ ì ìš©í•œ ì„¤ì •ë“¤ (Docker ë³¼ë¥¨ ì‚­ì œ ì‹œ ì¬ì ìš© í•„ìš”):

| í•­ëª© | ì ìš© ìœ„ì¹˜ | ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ë°˜ì˜ í•„ìš” |
|------|----------|:------------------------:|
| ARCHIVELOG ëª¨ë“œ | ì–‘ìª½ Oracle | âš ï¸ ë³„ë„ ì²˜ë¦¬ í•„ìš” |
| c##dbzuser ìƒì„± | ì–‘ìª½ Oracle CDB | âš ï¸ ì‹ ê·œ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” |
| Supplemental Logging | ì–‘ìª½ Oracle | âš ï¸ ì‹ ê·œ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” |
| SP_WORKER_BOOK ìˆ˜ì • | 04_create_procedures.sql | âœ… ë°˜ì˜ í•„ìš” |
| CDC_ASIS_BOOK ì»¬ëŸ¼ ì¶”ê°€ | 02_create_cdc_tables.sql | âœ… ë°˜ì˜ í•„ìš” |
| docker-compose í¬íŠ¸ ë³€ê²½ | docker-compose.yml | âœ… ì´ë¯¸ ë°˜ì˜ë¨ |

---

### 11.9 ì ‘ì† ì •ë³´ (í˜„ì¬ í™˜ê²½)

| ì„œë¹„ìŠ¤ | URL/ì ‘ì†ì •ë³´ |
|--------|-------------|
| ëŒ€ì‹œë³´ë“œ | http://localhost:8082/dashboard |
| Kafka UI | http://localhost:8081 |
| Kafka Connect API | http://localhost:8083 |
| ASIS Oracle | localhost:15210 / asis_user / asis123 |
| TOBE Oracle | localhost:15220 / tobe_user / tobe123 |

---

---

## 12. CDC ë™ê¸°í™” ì‹œë®¬ë ˆì´í„° ê°œì„  (2026-01-14)

### 12.1 ê°œì„  ë°°ê²½

ê¸°ì¡´ ëŒ€ì‹œë³´ë“œì˜ ë¬¸ì œì :
- static HTMLë¡œ ë™ì  ë°ì´í„° í‘œì‹œ ì–´ë ¤ì›€
- BOOK í…Œì´ë¸”ë§Œ í•˜ë“œì½”ë”©ë¨
- í…Œì´ë¸” ì¶”ê°€ ì‹œ Java/HTML ìˆ˜ì • í•„ìš”
- ë™ê¸°í™” íë¦„ ì¶”ì  ì–´ë ¤ì›€

### 12.2 ê°œì„  ë‚´ìš©

| í•­ëª© | ë³€ê²½ ì „ | ë³€ê²½ í›„ |
|------|---------|---------|
| UI ì—”ì§„ | Static HTML | Thymeleaf í…œí”Œë¦¿ |
| í…Œì´ë¸” ì§€ì› | BOOK í•˜ë“œì½”ë”© | YAML ì„¤ì • ê¸°ë°˜ ë™ì  |
| API | TestController (í•˜ë“œì½”ë”©) | SimulatorController (ë™ì ) |
| ê¸°ëŠ¥ êµ¬ë¶„ | ë‹¨ì¼ í™”ë©´ | 3ê°œ íƒ­ (í…ŒìŠ¤íŠ¸/íë¦„/ì´ë ¥) |

### 12.3 ìƒˆ íŒŒì¼ êµ¬ì¡°

```
sync-service-java/src/main/
â”œâ”€â”€ java/com/cdc/sync/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ CdcSimulatorConfig.java    # í…Œì´ë¸” ì„¤ì • ë°”ì¸ë”© (NEW)
â”‚   â””â”€â”€ monitoring/
â”‚       â”œâ”€â”€ SimulatorController.java    # ë™ì  API (NEW)
â”‚       â””â”€â”€ DashboardController.java    # Thymeleaf ì»¨íŠ¸ë¡¤ëŸ¬ (ìˆ˜ì •)
â””â”€â”€ resources/
    â”œâ”€â”€ application.yml                 # í…Œì´ë¸” ì„¤ì • ì¶”ê°€
    â””â”€â”€ templates/
        â””â”€â”€ simulator.html              # Thymeleaf í…œí”Œë¦¿ (NEW)
```

### 12.4 ìƒˆ API ì—”ë“œí¬ì¸íŠ¸ (SimulatorController)

| Method | URL | ì„¤ëª… |
|--------|-----|------|
| GET | /api/simulator/{tableName}/{db}/data | ì›ë³¸ í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/simulator/{tableName}/{db}/cdc | CDC í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/simulator/{tableName}/{db}/staging | STAGING í…Œì´ë¸” ì¡°íšŒ |
| GET | /api/simulator/sync-log | ë™ê¸°í™” ë¡œê·¸ ì¡°íšŒ |
| GET | /api/simulator/stats | í†µê³„ ì¡°íšŒ |
| POST | /api/simulator/{tableName}/{db}/insert | INSERT í…ŒìŠ¤íŠ¸ |
| POST | /api/simulator/{tableName}/{db}/update | UPDATE í…ŒìŠ¤íŠ¸ |
| POST | /api/simulator/{tableName}/{db}/delete | DELETE í…ŒìŠ¤íŠ¸ |

### 12.5 í…Œì´ë¸” ì„¤ì • (application.yml)

```yaml
cdc:
  simulator:
    tables:
      - name: BOOK
        display-name: ë„ì„œ
        direction: BIDIRECTIONAL
        asis:
          table: BOOK_INFO
          pk: BOOK_ID
          columns:
            - { name: BOOK_ID, type: NUMBER, display: "ë„ì„œID", required: true }
            # ...
        tobe:
          table: TB_BOOK
          pk: BOOK_ID
          columns:
            - { name: BOOK_ID, type: NUMBER, display: "ë„ì„œID", required: true }
            # ...
        cdc-table:
          asis: CDC_ASIS_BOOK
          tobe: CDC_TOBE_BOOK
        staging-table:
          asis: STAGING_ASIS_BOOK
          tobe: STAGING_TOBE_BOOK
```

### 12.6 ì§€ì› í…Œì´ë¸” ë° ë™ê¸°í™” ë°©í–¥

| í…Œì´ë¸” | í‘œì‹œëª… | ë°©í–¥ | ASIS í…Œì´ë¸” | TOBE í…Œì´ë¸” |
|--------|--------|------|-------------|-------------|
| BOOK | ë„ì„œ | ì–‘ë°©í–¥ | BOOK_INFO | TB_BOOK |
| MEMBER | íšŒì› | ì–‘ë°©í–¥ | MEMBER_INFO | TB_MEMBER |
| LEGACY_CODE | ë ˆê±°ì‹œì½”ë“œ | êµ¬â†’ì‹  | LEGACY_CODE | TB_LEGACY_CODE |
| NEW_SERVICE | ì‹ ê·œì„œë¹„ìŠ¤ | ì‹ â†’êµ¬ | NEW_SERVICE_RECV | TB_NEW_SERVICE |

### 12.7 UI íƒ­ êµ¬ì¡°

1. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰** - CUD í…ŒìŠ¤íŠ¸, ì›ë³¸ í…Œì´ë¸” ì¡°íšŒ
2. **ë™ê¸°í™” íë¦„** - ì›ë³¸â†’CDCâ†’STAGINGâ†’ëŒ€ìƒ ë‹¨ê³„ë³„ ì¶”ì 
3. **ì´ë ¥/í†µê³„** - CDC_SYNC_LOG ì¡°íšŒ, ì„±ê³µ/ì‹¤íŒ¨ í†µê³„

### 12.8 ì ‘ì† URL

| í˜ì´ì§€ | URL |
|--------|-----|
| ì‹œë®¬ë ˆì´í„° | http://localhost:8082/simulator |
| ì‹œë®¬ë ˆì´í„° (í…Œì´ë¸” ì§€ì •) | http://localhost:8082/simulator?table=MEMBER |
| ê¸°ì¡´ URL (ë¦¬ë‹¤ì´ë ‰íŠ¸) | http://localhost:8082/dashboard â†’ /simulator |

---

*ì‘ì„±ì¼: 2026-01-13*
*ìµœì¢… ìˆ˜ì •: 2026-01-14 (CDC ë™ê¸°í™” ì‹œë®¬ë ˆì´í„° ê°œì„ )*
